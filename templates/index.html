<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Recomendação Nutricional</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.3/vapor/bootstrap.min.css" integrity="sha512-9LoG2EQdcmuEQpzkslqa3whcL8LM+7GGPsW2MK1gRlmiML0G7M5ZPj2aZaW2DyixslBfZoy4kANfP/MYWDCSiw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        input:hover {
            box-shadow: 0px 0px 20px rgb(0, 255, 255);
            transition: all 0.3s ease-in-out;
        }
        .btn-success:hover {
            transform: scale(1.05);
            transition: all 0.2s ease-in-out;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h2 class="text-center">Recomendação Nutricional</h2>
        <div class="row d-flex justify-content-center align-items-center">
            <div class="col-md-6 col-sm-12">
                <form id="formRecomendacao" enctype="multipart/form-data">
                    <!-- Campos do formulário -->
                    <div class="mb-3">
                        <label for="nome" class="form-label">Nome</label>
                        <input type="text" class="form-control" id="nome" required>
                    </div>
                    <div class="mb-3">
                        <label for="glicose" class="form-label">Glicose</label>
                        <input type="number" step="0.1" class="form-control" id="glicose">
                    </div>
                    <div class="mb-3">
                        <label for="t3" class="form-label">T3</label>
                        <input type="number" step="0.1" class="form-control" id="t3">
                    </div>
                    <div class="mb-3">
                        <label for="t4" class="form-label">T4</label>
                        <input type="number" step="0.1" class="form-control" id="t4">
                    </div>
                    <div class="mb-3">
                        <label for="tsh" class="form-label">TSH</label>
                        <input type="number" step="0.1" class="form-control" id="tsh">
                    </div>
                    <div class="mb-3">
                        <label for="colesterol_total" class="form-label">Colesterol Total</label>
                        <input type="number" step="0.1" class="form-control" id="colesterol_total">
                    </div>
                    <div class="mb-3">
                        <label for="triglicerideos" class="form-label">Triglicerídeos</label>
                        <input type="number" step="0.1" class="form-control" id="triglicerideos">
                    </div>
                    <div class="mb-3">
                        <label for="pdfExame" class="form-label">Anexar PDF do Exame</label>
                        <input type="file" class="form-control" id="pdfExame" accept="application/pdf" required>
                    </div>
                    <div class="text-center pt-3">
                        <button type="submit" class="btn btn-success btn-lg w-50">Obter Recomendação</button>
                    </div>
                </form>
            </div>
        </div>
        <div class="mt-3" id="resultado"></div>
    </div>

    <script>
        document.getElementById("formRecomendacao").addEventListener("submit", async function(event) {
            event.preventDefault();

            let formData = new FormData(this);
            const file = document.getElementById("pdfExame").files[0];

            const nome = document.getElementById("nome").value;
            formData.append("nome", nome);

            if (file) {
                console.log("PDF selecionado:", file.name);
                formData.append("pdfExame", file);
            }

            try {
                const response = await fetch("/upload_pdf", {
                    method: "POST",
                    body: formData
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log("Dados recebidos:", data);

                    if (data.resultados) {
                        document.getElementById("glicose").value = data.resultados.glicose || '';
                        document.getElementById("t3").value = data.resultados.t3 || '';
                        document.getElementById("t4").value = data.resultados.t4 || '';
                        document.getElementById("tsh").value = data.resultados.tsh || '';
                        document.getElementById("colesterol_total").value = data.resultados.colesterol || '';
                        document.getElementById("triglicerideos").value = data.resultados.triglicerideos || '';
                    }
                } else {
                    console.log("Falha no envio do PDF.");
                }
            } catch (error) {
                console.error("Erro ao enviar o PDF:", error);
            }
        });

    </script>
    
</body>
</html>